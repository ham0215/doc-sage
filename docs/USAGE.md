# 📖 Doc Sage 使い方ガイド

## 目次

- [初めての方へ](#初めての方へ)
- [基本的な使い方](#基本的な使い方)
- [詳細な機能説明](#詳細な機能説明)
- [よくある質問](#よくある質問)
- [ベストプラクティス](#ベストプラクティス)

## 初めての方へ

Doc Sageは、PDFドキュメントに対して自然言語で質問できるAIチャットボットです。大量の資料から必要な情報を素早く見つけたり、内容を要約したりできます。

### 何ができるの？

- 📄 PDFドキュメントの内容について質問
- 🔍 関連する情報の検索
- 📝 要約の生成
- 💡 内容の説明・解説
- 🔗 複数の情報の関連付け

### 準備するもの

1. PDFファイル（質問したいドキュメント）
2. OpenAI APIキー
3. Docker（インストール済み）

## 基本的な使い方

### ステップ1: アプリケーションの起動

```bash
# プロジェクトディレクトリに移動
cd doc-sage

# Dockerで起動
docker compose up
```

ブラウザで http://localhost:8501 を開きます。

### ステップ2: PDFファイルのアップロード

1. 画面左のサイドバーにある「📤 ドキュメントアップロード」セクションを探します
2. 「PDFファイルを選択」ボタンをクリック
3. 質問したいPDFファイルを選択
4. 「📥 アップロードして処理」ボタンをクリック

**処理中の表示:**
```
✓ PDFを読み込んでいます...
✓ XXX個のチャンクに分割しました
✓ ベクトルストアを作成しています...
✓ ベクトルストアを作成しました
✅ ドキュメントの処理が完了しました！
```

処理には数秒〜数分かかります（ドキュメントのサイズによる）。

### ステップ3: 質問する

1. メイン画面下部のチャット入力欄に質問を入力
2. Enterキーを押すか、送信ボタンをクリック
3. AIが回答を生成するまで待つ（数秒）

**質問の例:**
```
- この文書の要約を教えてください
- ○○について説明してください
- XXとYYの違いは何ですか？
- この手順の詳細を教えてください
```

### ステップ4: 参照元の確認

AIの回答の下に「📄 参照元を表示」ボタンがあります。クリックすると：

- 回答の根拠となったドキュメントの該当箇所
- ページ番号
- テキストの抜粋

が表示されます。

## 詳細な機能説明

### ドキュメント管理

#### アップロード可能なファイル

- **対応形式**: PDF (.pdf)
- **ファイルサイズ**: 制限なし（ただし処理時間が長くなる）
- **文字コード**: UTF-8推奨

#### ドキュメント情報の確認

サイドバーの「📄 現在のドキュメント」セクションで確認できます：

- ファイル名
- ステータス（processing / completed / failed）
- アップロード日時

### チャット機能

#### 会話の継続

Doc Sageは会話の文脈を理解します：

```
User: この文書の主なトピックは？
Assistant: 主なトピックは...

User: それについて詳しく教えて
Assistant: [前の回答を踏まえた詳細な説明]
```

#### 会話履歴のクリア

サイドバーの「🗑️ チャット履歴をクリア」ボタンをクリックすると：

- 画面上の会話履歴が削除される
- AIの会話記憶もリセットされる
- データベースの履歴は保持される

### 参照元表示

#### 表示される情報

各参照元について以下が表示されます：

1. **ページ番号**: ドキュメント内のページ位置
2. **テキスト抜粋**: 該当箇所の最初の200文字
3. **メタデータ**: ファイル名などの追加情報

#### 複数の参照元

AIは通常3〜5箇所の参照元を使用して回答を生成します。

### セッション管理

#### セッションID

- 各ユーザーセッションに一意のIDが割り当てられます
- サイドバー下部の「ℹ️ セッション情報」で確認できます
- セッションIDは会話履歴の管理に使用されます

#### メッセージ数

- 現在のセッションでの総メッセージ数を表示
- ユーザーとアシスタントの両方をカウント

## よくある質問

### Q1: 処理に時間がかかるのはなぜ？

**A:** PDFの処理には以下のステップがあります：

1. PDFからテキストを抽出
2. テキストを小さなチャンク（断片）に分割
3. 各チャンクをベクトル（数値表現）に変換
4. ベクトルをデータベースに保存

大きなファイルや複雑なレイアウトの場合、処理時間が長くなります。

### Q2: どんな質問ができますか？

**A:** 以下のような質問が可能です：

**要約系**
- 「この文書を要約して」
- 「主なポイントを教えて」

**検索系**
- 「○○について書いてある箇所を教えて」
- 「XXの定義は？」

**説明系**
- 「この手順を詳しく説明して」
- 「なぜYYが重要なの？」

**比較系**
- 「AとBの違いは？」
- 「これらのオプションを比較して」

### Q3: 日本語と英語どちらにも対応していますか？

**A:** はい、両方に対応しています。PDFが日本語でも英語でも、質問は日本語・英語どちらでも可能です。

### Q4: 画像や表は認識されますか？

**A:** 現在のバージョンでは、テキストのみを認識します。画像や表に含まれる情報は抽出されません。

### Q5: 複数のPDFを同時に扱えますか？

**A:** 現在のバージョンでは、一度に1つのPDFのみ扱えます。別のPDFをアップロードすると、前のPDFが置き換わります。

### Q6: 処理したPDFはどこに保存されますか？

**A:** `data/documents/` ディレクトリに保存されます。Dockerボリュームとしてマウントされているため、コンテナを削除しても保持されます。

### Q7: 会話履歴はどこに保存されますか？

**A:** SQLiteデータベース（`data/doc-sage.db`）に保存されます。

### Q8: OpenAI APIの使用料金はどれくらい？

**A:** 使用量により異なりますが、目安：

- 1回の質問: 約0.01〜0.05ドル
- PDFの処理（100ページ）: 約0.1〜0.5ドル

詳細は[OpenAIの料金ページ](https://openai.com/pricing)をご確認ください。

## ベストプラクティス

### 効果的な質問の仕方

**✅ 良い質問例:**
```
- 「第3章の主要なポイントを3つ教えてください」
- 「データベース設計について、どのような方針が推奨されていますか？」
- 「この手順の前提条件は何ですか？」
```

**❌ 避けるべき質問:**
```
- 「いろいろ教えて」（曖昧すぎる）
- 「全部要約して」（情報量が多すぎる）
- 「この画像は何？」（画像は認識できない）
```

### パフォーマンスの最適化

1. **適切なファイルサイズ**
   - 可能であれば、必要なページのみに絞る
   - 100ページ以下が理想的

2. **明確な質問**
   - 具体的なキーワードを含める
   - 質問の範囲を絞る

3. **段階的な質問**
   - 最初は大まかな質問
   - その後、詳細を深掘り

### セキュリティのベストプラクティス

1. **機密情報の取り扱い**
   - 機密性の高いドキュメントは、セキュアな環境で実行
   - 必要に応じてAPIキーを定期的にローテーション

2. **データの削除**
   - 不要になったドキュメントは`data/documents/`から削除
   - データベースもバックアップ後に削除可能

## トラブルシューティング

### エラー: "OPENAI_API_KEY is not set"

**原因:** 環境変数が設定されていない

**解決方法:**
```bash
# .envファイルを確認
cat .env

# 正しく設定されていることを確認
OPENAI_API_KEY=sk-...
```

### エラー: "PDF file not found"

**原因:** ファイルのアップロードに失敗

**解決方法:**
1. ファイルサイズを確認（大きすぎないか）
2. ファイル名に特殊文字が含まれていないか確認
3. もう一度アップロードを試す

### 回答が不正確

**原因:** ドキュメントの内容と質問がマッチしていない

**解決方法:**
1. 質問をより具体的にする
2. ドキュメント内のキーワードを使用する
3. 参照元を確認して、期待する箇所が検索されているか確認

### 処理が遅い

**原因:** ドキュメントが大きい、システムリソース不足

**解決方法:**
1. ファイルサイズを削減
2. Dockerのメモリ割り当てを増やす
3. 他のアプリケーションを終了してリソースを確保

## サポート

問題が解決しない場合は、以下をお試しください：

1. **GitHub Issues**: [問題を報告](https://github.com/ham0215/doc-sage/issues)
2. **ログの確認**: `docker compose logs -f` でログを確認
3. **再起動**: `docker compose restart` でコンテナを再起動

---

**ドキュメントバージョン:** 1.0
**最終更新:** 2025-10-01
